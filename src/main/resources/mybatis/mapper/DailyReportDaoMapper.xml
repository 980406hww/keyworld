<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keymanager.monitoring.dao.DailyReportDao">

    <select id="findByStatus" resultType="com.keymanager.monitoring.entity.DailyReport">
        SELECT
          dr.fUuid         AS 'uuid',
          dr.fTerminalType AS 'terminalType',
          dr.fTriggerTime  AS 'triggerTime',
          dr.fCompleteTime AS 'completeTime',
          dr.fStatus       AS 'status',
          dr.fReportPath   AS 'reportPath',
          dr.fUpdateTime   AS 'updateTime',
          dr.fCreateTime   AS 'createTime'
        FROM t_daily_report dr
        WHERE dr.fStatus = #{status}
        limit 1
    </select>

    <select id="searchCurrentDateCompletedReports" resultType="com.keymanager.monitoring.entity.DailyReport">
        SELECT
          dr.fUuid         AS 'uuid',
          dr.fTerminalType AS 'terminalType',
          dr.fTriggerTime  AS 'triggerTime',
          dr.fCompleteTime AS 'completeTime',
          dr.fStatus       AS 'status',
          dr.fReportPath   AS 'reportPath',
          dr.fUpdateTime   AS 'updateTime',
          dr.fCreateTime   AS 'createTime'
        FROM t_daily_report dr
        WHERE dr.fStatus = 'Completed'
            AND dr.fCompleteTime > CURRENT_DATE()
    </select>

    <select id="selectLastId" resultType="long">
        select LAST_INSERT_ID()
    </select>

    <delete id="deleteDailyReportFromAWeekAgo">
        DELETE FROM t_daily_report WHERE fCreateTime &lt; DATE_SUB(CURDATE(), INTERVAL 7 DAY)
    </delete>

    <select id="fetchDailyReportTriggeredInToday" resultType="com.keymanager.monitoring.entity.DailyReport">
        SELECT
          dr.fUuid         AS 'uuid',
          dr.fTerminalType AS 'terminalType',
          dr.fTriggerTime  AS 'triggerTime',
          dr.fCompleteTime AS 'completeTime',
          dr.fStatus       AS 'status',
          dr.fReportPath   AS 'reportPath',
          dr.fUpdateTime   AS 'updateTime',
          dr.fCreateTime   AS 'createTime'
        FROM t_daily_report dr
        WHERE dr.fTriggerMode = #{triggerMode}
        AND dr.fCreateTime > CURRENT_DATE()
        limit 1
    </select>
</mapper>