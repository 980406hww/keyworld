<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keymanager.monitoring.dao.QZKeywordRankInfoDao">

    <select id="searchExistingQZKeywordRankInfo" parameterType="java.lang.Long" resultType="com.keymanager.monitoring.entity.QZKeywordRankInfo">
        SELECT
            qzkri.fUuid AS "uuid",
            qzkri.fQZSettingUuid AS "qzSettingUuid",
            qzkri.fTerminalType AS "terminalType",
            qzkri.fWebSiteType AS "websiteType",
            qzkri.fTopTen AS "topTen",
            qzkri.fTopTwenty AS "topTwenty",
            qzkri.fTopThirty AS "topThirty",
            qzkri.fTopForty AS "topForty",
            qzkri.fTopFifty AS "topFifty",
            qzkri.fDate AS "date",
            qzkri.fFullDate AS "fullDate",
            qzkri.fIncrease AS "increase"
        FROM t_qz_keyword_rank_info qzkri
        WHERE qzkri.fQZSettingUuid = #{qzSettingUuid}
    </select>

    <delete id="deleteByQZSettingUuid" parameterType="java.lang.Long">
        DELETE FROM t_qz_keyword_rank_info
        WHERE fQZSettingUuid = #{qzSettingUuid}
    </delete>
    <select id="getQZSettingTask" resultType="com.keymanager.monitoring.vo.ExternalQzSettingVo">
        SELECT
            qs.fUuid AS 'uuid',
            qs.fDomain AS 'domain',
            qs.fPcGroup AS 'pcGroup',
            qs.fPhoneGroup AS 'phoneGroup',
            qs.fCreateTime AS 'createTime'
        FROM t_qz_setting qs
        JOIN t_customer c
        ON qs.fCustomerUuid = c.fUuid
        WHERE qs.fCrawlerStatus='new' OR qs.fUuid IN(
        SELECT
          fUuid
        FROM
          t_qz_setting
        WHERE
           (fCrawlerStatus = 'finish' AND DATE_ADD(fCrawlerTime,INTERVAL 8 HOUR) &lt;= NOW())
        OR (fCrawlerStatus = 'processing' AND DATE_ADD(fCrawlerTime,INTERVAL 8 HOUR) &lt;= NOW())
        )
    </select>

    <select id="getQzKeywordRankInfoID" resultType="com.keymanager.monitoring.entity.QZKeywordRankInfo">
    SELECT
      fUuid AS 'uuid',
      fTerminalType AS 'terminalType',
      fQZSettingUuid AS 'qzSettingUuid'
    FROM
      t_qz_keyword_rank_info
    </select>
</mapper>