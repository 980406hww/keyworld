<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.keymanager.monitoring.dao.ResourceDao">

    <!-- 通用查询结果列-->
    <sql id="colID">
        s.fUuid AS `id`,
        s.fResourceName AS `resourceName`,
        s.fUrl AS `url`,
        s.fOpenMode AS `openMode`,
        s.fDescription AS `description`,
        s.fIconCls AS `icon`,
        s.fParentID AS `parentID`,
        s.fSequence AS `sequence`,
        s.fStatus AS `status`,
        s.fOpened AS `opened`,
        s.fResourceType AS `resourceType`,
        s.fUpdateTime AS `updateIime`,
        s.fCreateTime AS `createTime`
    </sql>

    <select id="selectAuthorizationMenu" resultType="com.keymanager.monitoring.entity.Resource">
        SELECT
        <include refid="colID"/>
        FROM
        t_resource s
        WHERE
        s.fUuid IN (
        SELECT
        rr.fResourceID
        FROM
        t_role_resource rr
        WHERE
        rr.fRoleID IN (
        SELECT
        ur.fRoleID
        FROM
        t_user_role ur
        WHERE
        ur.fUserID = (
        SELECT
        fUuid
        FROM
        t_userinfo
        WHERE
        fLoginName = #{loginName}
        )
        )
        )
        AND s.fResourceType = 0
        ORDER BY s.fSequence DESC
    </select>
</mapper>