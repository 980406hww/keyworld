<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>添加</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/ok-admin/lib/layui/css/layui.css">
    <link rel="stylesheet" href="/static/ok-admin/css/sub-page.css">
    <style>
        .padding-ten-left {
            padding-left: 2px;
        }

        .padding-ten-right {
            padding-right: 2px;
        }

        .layui-btn {
            width: 150px;
        }

        .qzsetting-box {
            padding: 10px 10px 5px 10px;
            border-radius: 2px 0 0 2px;
            border: solid 1px #e6e6e6;
        }
    </style>
</head>
<div>
    <!--form表单-->
    <form class="layui-form layui-form-pane ok-form" lay-filter="excludeExcludeKeyword">
        <div class="ok-body">
            <input type="hidden" name="excludeKeywordUuid" id="excludeKeywordUuid" />
            <input type="hidden" name="qzSettingUuid" id="qzSettingUuid" />
            <input type="hidden" name="customerUuid" id="customerUuid" />
            <input type="hidden" name="terminalType" id="terminalType" />
            <div class="layui-row">
                <div class="layui-form-item">
                    <label class="layui-form-label">域名</label>
                    <div class="layui-input-block">
                        <input type="text" name="qzSettingDomain" placeholder="请输入域名"
                               autocomplete="off"
                               class="layui-input" readonly>
                    </div>
                </div>

            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">终端类型</label>
                <div class="layui-input-block">
                    <select name="searchEngine">
                        <option value="PC">PC</option>
                        <option value="Phone">Phone</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">关键字</label>
                <div class="layui-input-block">
                    <textarea name="customerKeywordDialogContent" id="customerKeywordDialogContent" placeholder="" class="layui-textarea"></textarea>
                </div>
            </div>

        </div>
        <div style="position: fixed;bottom: 0;width: 100%;background:#fff;text-align: right;">
            <div style="margin: 0 10px 6px 10px; padding-top: 8px;border-top: solid 1px #e6e6e6">
                <button class="layui-btn" lay-submit lay-filter="save">确定</button>
                <button type="reset" class="layui-btn layui-btn-primary" style="margin-right: 20px">
                    重置
                </button>
                <button class="layui-btn layui-btn-primary" id="close" style="margin-right: 20px">
                    取消
                </button>
            </div>
        </div>
    </form>
</div>
<!--js逻辑-->

<script src="/static/ok-admin/lib/layui/layui.js"></script>
<script>

    let data_ = null;
    let layui_ = null;

    function initForm(data) {
        data_ = data;
        if (layui_ != null) {
            setForm(layui_, data_);
        }
    }

    function setForm(layui_, data) {
        // console.log(data)
        var $ = layui_.$;

        $("#qzSettingUuid").val(data.qzSettingUuid);
        $("#customerUuid").val(data.customerUuid);
        $("#terminalType").val(data.terminalType);
        $("#domain").val(data.domain);
        echoExcludeKeyword($, data.qzSettingUuid, data.terminalType)
    }


    function echoExcludeKeyword($, qzSettingUuid, terminalType) {
        var postData = {};
        postData.qzSettingUuid = qzSettingUuid;
        postData.terminalType = terminalType;
        $.ajax({
            url: '/internal/qzsetting/echoExcludeKeyword2',
            type: 'POST',
            data: JSON.stringify(postData),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (result) {
                if (result.code === 200 && result.data != null) {
                    result.data.keyword = result.data.keyword.replace(/[,]/g, "\n");
                    console.log(result.data);
                    $("#excludeKeywordUuid").val(result.data.uuid);
                    $("#customerKeywordDialogContent").val(result.data.keyword);

                }
            },
            error: function (result) {
                l.layer.msg(result.msg);
            }
        });
    }

    function excludeCustomerKeywords(qzSettingUuid, customerUuid, domain, optimizedGroupName) {
        var excludeCustomerKeywordDialog = $("#excludeCustomerKeywordDialog");
        var terminalType = excludeCustomerKeywordDialog.find("#terminalType").val();
        var excludeKeywordUuid = excludeCustomerKeywordDialog.find("#excludeKeywordUuid").val();
        var keywordStr = excludeCustomerKeywordDialog.find("#customerKeywordDialogContent").val();
        if (keywordStr === "") {
            $.messager.alert('提示', '请输入关键字！！', 'warning');
            excludeCustomerKeywordDialog.find("#customerKeywordDialogContent").focus();
            return false;
        }
        keywordStr = keywordStr.replace(/[，|\r\n]/g, ",").replace(/[\s+]/g, "");
        if (keywordStr.substring(keywordStr.length - 1) === ','){
            keywordStr = keywordStr.substring(0, keywordStr.length - 1);
        }
        var keywords = keywordStr.split(',');
        keywords = keywords.filter(function (keyword, index) {
            return keywords.indexOf(keyword) === index && keyword !== '';
        });
        var postData = {};
        postData.excludeKeywordUuid = excludeKeywordUuid;
        postData.qzSettingUuid = qzSettingUuid;
        postData.customerUuid = customerUuid;
        postData.domain = $.trim(domain);
        postData.optimizeGroupName = optimizedGroupName;
        postData.terminalType = $.trim(terminalType);
        postData.keywords = keywords;
        $.ajax({
            url: '/internal/qzsetting/excludeQZSettingCustomerKeywords',
            type: 'POST',
            data: JSON.stringify(postData),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (data) {
                if (data) {
                    $().toastmessage('showSuccessToast', "保存成功！");
                    $("#excludeCustomerKeywordDialog").dialog("close");
                } else {
                    $().toastmessage('showErrorToast', "保存失败！");
                }
            },
            error: function () {
                $().toastmessage('showErrorToast', "保存失败！");
            }
        });
    }

    layui.use(["form", "okLayer", "jquery", "layer"], function () {
        let form = layui.form;
        let okLayer = layui.okLayer;
        let $ = layui.jquery;
        let layer = layui.layer;

        if (data_ != null) {
            setForm(layui, data_);
        } else {
            layui_ = layui;
        }



        form.on("submit(save)", function (data) {

            console.log(data);
            // $.ajax({
            //   url: '/internal/customer/postCustomersAdd',
            //   type: 'post',
            //   // 用于设置响应体的类型 注意 跟 data 参数没关系！！！
            //   data: data.field,
            //   dataType: 'json',
            //   success: function (res) {
            //     // 一旦设置的 dataType 选项，就不再关心 服务端 响应的 Content-Type 了
            //     // 客户端会主观认为服务端返回的就是 JSON 格式的字符串
            //     if (res.code === 200) {
            //       okLayer.msg.greenTick("保存成功", function () {
            //         parent.window.sign = true;
            //         // parent.window.myTable.reload();
            //         parent.layer.close(parent.layer.getFrameIndex(window.name));
            //       });
            //     } else {
            //       layui.layer.msg(res.msg);
            //     }
            //   }
            // });
            return false;
        });

        $('#close').click(function () {
            okLayer.close();
        });

    })

</script>
</body>
</html>
