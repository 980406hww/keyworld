<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>添加</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/static/ok-admin/lib/layui/css/layui.css">
  <link rel="stylesheet" href="/static/ok-admin/css/sub-page.css">
  <style>
    .padding-ten-left {
      padding-left: 2px;
    }

    .padding-ten-right {
      padding-right: 2px;
    }

    .layui-btn {
      width: 150px;
    }

    .qzsetting-box {
      padding: 10px 10px 5px 10px;
      border-radius: 2px 0 0 2px;
      border: solid 1px #e6e6e6;
      margin-bottom: 5px;
    }
  </style>
</head>
<div>
  <!--form表单-->
  <form class="layui-form layui-form-pane ok-form" lay-filter="addCustomer">
    <div class="ok-body">
      <input type="hidden" name="qzSettingUuid"/>
      <div class="layui-form-item">
        <label class="layui-form-label">客户</label>
        <div class="layui-input-block">
          <input type="text" name="qzSettingCustomer" placeholder="请输入客户" autocomplete="off"
                 class="layui-input" disabled>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">域名</label>
        <div class="layui-input-block">
          <input type="text" name="qzSettingDomain" placeholder="请输入域名" autocomplete="off"
                 class="layui-input" disabled>
        </div>
      </div>
      <!--      <fieldset class="layui-elem-field layui-field-title">-->
      <!--        <legend>收费规则</legend>-->
      <!--      </fieldset>-->
      <div class="layui-row">
        <div class="layui-col-md6 padding-ten-right">
          <div class="layui-form-item" pane>
            <label class="layui-form-label">电脑</label>
            <div class="layui-input-block">
              <input type="checkbox" checked name="computer" lay-skin="switch" lay-filter="computer"
                     lay-text="Select|Deselect">
            </div>
          </div>
          <div id="comQzsettingBox" class="qzsetting-box">
            <input type="hidden" name="qzOperationTypeUuid"/>
            <div class="layui-form-item">
              <label class="layui-form-label">初始词量</label>
              <div class="layui-input-block">
                <input type="text" name="initialKeywordCount" placeholder="请输入初始词量"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">当前词量</label>
              <div class="layui-input-block">
                <input type="text" name="currentKeywordCount" placeholder="请输入当前词量"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">应收金额</label>
              <div class="layui-input-block">
                <input type="text" name="receivableAmount" placeholder="请输入应收金额"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">计划收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="planChargeDate" placeholder="请选择计划收费日期"
                       autocomplete="off" id="layui-date-one" class="layui-input"
                       lay-verify="required" disabled>
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">下次收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="nextChargeDate" placeholder="请选择下次收费日期"
                       autocomplete="off" id="layui-date-two" class="layui-input"
                       lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">实收金额</label>
              <div class="layui-input-block">
                <input type="text" name="actualAmount" placeholder="请输入实收金额" id="pc-i"
                       autocomplete="off" class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">实际收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="actualChargeDate" placeholder="请选择实际收费日期"
                       autocomplete="off" id="layui-date-three" class="layui-input"
                       lay-verify="required">
              </div>
            </div>
          </div>
        </div>
        <div class="layui-col-md6 padding-ten-left">
          <div class="layui-form-item" pane>
            <label class="layui-form-label">手机</label>
            <div class="layui-input-block">
              <input type="checkbox" checked name="phone" lay-skin="switch" lay-filter="phone"
                     lay-text="Select|Deselect">
            </div>
          </div>
          <div id="phoneQzsettingBox" class="qzsetting-box">
            <input type="hidden" name="qzOperationTypeUuid"/>
            <div class="layui-form-item">
              <label class="layui-form-label">初始词量</label>
              <div class="layui-input-block">
                <input type="text" name="initialKeywordCount" placeholder="请输入初始词量"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">当前词量</label>
              <div class="layui-input-block">
                <input type="text" name="currentKeywordCount" placeholder="请输入当前词量"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">应收金额</label>
              <div class="layui-input-block">
                <input type="text" name="receivableAmount" placeholder="请输入应收金额"
                       autocomplete="off" disabled
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">计划收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="planChargeDate" placeholder="请选择计划收费日期"
                       autocomplete="off" id="layui-date-four" class="layui-input"
                       lay-verify="required" disabled>
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">下次收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="nextChargeDate" placeholder="请选择下次收费日期"
                       autocomplete="off" id="layui-date-five" class="layui-input"
                       lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">实收金额</label>
              <div class="layui-input-block">
                <input type="text" name="actualAmount" placeholder="请输入实收金额"
                       autocomplete="off" id="phone-i"
                       class="layui-input" lay-verify="required">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">实际收费日期</label>
              <div class="layui-input-block">
                <input type="text" name="actualChargeDate" placeholder="请选择实际收费日期"
                       autocomplete="off" id="layui-date-six" class="layui-input"
                       lay-verify="required">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">合计</label>
        <div class="layui-input-block">
          <input type="text" autocomplete="off" class="layui-input" disabled
                 id="total" lay-verify="required">
        </div>
      </div>
    </div>
    <div style="position: fixed;bottom: 0;width: 100%;background:#fff;text-align: right;">
      <div style="margin: 0 10px 6px 10px; padding-top: 8px;border-top: solid 1px #e6e6e6">
        <button class="layui-btn" lay-submit lay-filter="commitCustomer">确定</button>
        <button class="layui-btn layui-btn-primary" id="close" style="margin-right: 20px">
          取消
        </button>
      </div>
    </div>
  </form>
</div>
<!--js逻辑-->

<script src="/static/ok-admin/lib/layui/layui.js"></script>
<script>

  let uuid_ = null;
  let layui_ = null;

  function initForm(data) {
    uuid_ = data;
    if (layui_ != null) {
      setForm(layui_, uuid_);
    }
  }

  function setForm(l, u) {
    l.jquery.ajax({
      url: '/internal/customer/getCustomersMsgById/' + u,
      type: 'get',
      dataType: 'json',
      success: function (res) {
        if (res.code === 200) {
          if (res.data.dailyReportIdentify) {
            res.data.dailyReportIdentify = 1
          } else {
            res.data.dailyReportIdentify = 0
          }
          layui.form.val("addCustomer", res.data);
        } else {
          l.layer.msg(res.msg);
        }
      }
    });
  }

  let pc_i = document.getElementById('pc-i');
  let phone_i = document.getElementById('phone-i');
  let total = document.getElementById('total');

  pc_i.onchange = setTotal;
  phone_i.onchange = setTotal;

  function setTotal() {
    let pc_v = pc_i.value.trim();
    let phone_v = phone_i.value.trim();
    if (/(^$)|(^\d+$)/.test(pc_v) || /(^$)|(^\d+$)/.test(phone_v)) {
      total.value = Number(pc_v) + Number(phone_v);
    } else {
      total.value = '';
    }
  }

  layui.use(["form", "okLayer", "jquery", "layer", 'laydate'], function () {
    let form = layui.form;
    let okLayer = layui.okLayer;
    let $ = layui.jquery;
    let layer = layui.layer;
    let laydate = layui.laydate;

    if (uuid_ != null) {
      setForm(layui, uuid_);
    } else {
      layui_ = layui;
    }

    let comQzsettingBox = document.getElementById('comQzsettingBox');
    //监听指定开关
    form.on('switch(computer)', function (data) {
      if (this.checked) {
        comQzsettingBox.style.display = 'block';
      } else {
        comQzsettingBox.style.display = 'none';
      }
      // layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
    });

    let phoneQzsettingBox = document.getElementById('phoneQzsettingBox');
    //监听指定开关
    form.on('switch(phone)', function (data) {
      if (this.checked) {
        phoneQzsettingBox.style.display = 'block';
      } else {
        phoneQzsettingBox.style.display = 'none';
      }
    });

    form.on("submit(commitCustomer)", function (data) {
      console.log(data);
      // $.ajax({
      //   url: '/internal/customer/postCustomersAdd',
      //   type: 'post',
      //   // 用于设置响应体的类型 注意 跟 data 参数没关系！！！
      //   data: data.field,
      //   dataType: 'json',
      //   success: function (res) {
      //     // 一旦设置的 dataType 选项，就不再关心 服务端 响应的 Content-Type 了
      //     // 客户端会主观认为服务端返回的就是 JSON 格式的字符串
      //     if (res.code === 200) {
      //       okLayer.msg.greenTick("保存成功", function () {
      //         parent.window.sign = true;
      //         // parent.window.myTable.reload();
      //         parent.layer.close(parent.layer.getFrameIndex(window.name));
      //       });
      //     } else {
      //       layui.layer.msg(res.msg);
      //     }
      //   }
      // });
      return false;
    });

    $('#close').click(function () {
      okLayer.close();
    });

    //常规用法
    laydate.render({elem: '#layui-date-one'});
    laydate.render({elem: '#layui-date-two'});
    laydate.render({elem: '#layui-date-three'});
    laydate.render({elem: '#layui-date-four'});
    laydate.render({elem: '#layui-date-five'});
    laydate.render({elem: '#layui-date-six'});

    form.verify({
      qq: [
        /(^$)|(^[1-9]\d{4,14}$)/,
        "请输入正确格式QQ"
      ],
      telPhone: [
        /(^$)|(^(13[0-9]|14[5-9]|15[0-3,5-9]|16[2567]|17[0-8]|18[0-9]|19[13589])\d{8}$)/,
        "请输入正确格式手机号码"
      ]
    });
  })

</script>
</body>
</html>
