<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>关键字列表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/lib/layui/css/layui.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/css/scroll-bar.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/css/sub-page.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/lib/nprogress/nprogress.css">
    <style>

    </style>
</head>
<body>
<div class="ok-body">
    <!--面包屑导航区域-->
    <div class="ok-body-breadcrumb">
            <span class="layui-breadcrumb">
                <a><cite>关键字管理</cite></a>
                <a><cite>关键字列表</cite></a>
            </span>


        <a class="layui-btn layui-btn-sm" href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon layui-icon-refresh"></i>
        </a>
    </div>

    <!--模糊搜索区域-->
    <div class="layui-card ">
        <div class="layui-card-body ">
            <div class="layui-collapse" lay-filter="test">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">条件筛选<i class="layui-icon layui-colla-icon"></i></h2>
                    <div class="layui-colla-content" id="searchContent">
                        <form class="layui-form layui-form-pane" id="searchForm">
                            <div class="layui-form-item" lay-filter="loginNameFilter">
                                <input hidden value='<#if Request.customerUuid?exists>${Request.customerUuid}</#if>'
                                       id="customerUuid" name="customerUuid">
                                <div class="layui-inline">
                                    <div class="layui-input-inline">
                                        <input type="text" name="keyword" id="keyword" placeholder="关键字"
                                               autocomplete="off"
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 150px;">
                                        <select name="terminalType" id="terminalType" lay-filter="terminalTypeFilter" lay-search>
                                            <option value="">请选择终端</option>
                                            <option value="PC">PC</option>
                                            <option value="Phone">Phone</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 150px;">
                                        <select name="searchEngine" id="searchEngine" lay-filter="searchEngineFilter" lay-search>
                                            <option value="">请选择搜索引擎</option>

                                        </select>
                                    </div>
                                </div>

                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 150px;">
                                        <select name="status" id="status" lay-filter="statusFilter" lay-search>
                                            <option value="">请选择关键字状态</option>
                                            <option value="0">暂停</option>
                                            <option value="1">激活</option>
                                            <option value="2">新增</option>
                                            <option value="3">降序</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 150px;">
                                        <select name="orderBy" id="orderBy" lay-filter="orderByFilter" lay-search>
                                            <option value="">请选择排序字段</option>
                                            <option value="keyword">关键字</option>
                                            <option value="terminalType">终端</option>
                                            <option value="searchEngine">搜索引擎</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 150px;">
                                        <select name="orderMode" id="orderMode" lay-filter="orderModeFilter" lay-search>
                                            <option value="">请选择排序方式</option>
                                            <option value="1">升序</option>
                                            <option value="0">降序</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline">
                                        <button class="layui-btn" lay-submit="" lay-filter="search" id="searchBtn">搜索</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


<!--数据表格-->
<table class="layui-hide" id="productKeywordTable" lay-filter="tableFilter">

</table>
</div>
<!--js逻辑-->
<script src="${ctx.basePath}/static/ok-admin/lib/layui/layui.js"></script>
<script src="${ctx.basePath}/static/ok-admin/lib/nprogress/nprogress.js"></script>
<script>
    var sign = false;
    // 进度条加载提示
    NProgress.start();
    window.onload = function () {
        NProgress.done();
    };
    // layui相关
    layui.use(['element', 'table', 'form', 'jquery', 'laydate', 'okLayer', 'layer'], function () {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        var $ = layui.jquery;

        var productKeywordTable = table.render({
            elem: '#productKeywordTable',
            method: 'post',
            url: '${ctx.path}/internal/productKeyword/searchProductKeywords',
            limit: 50,
            page: true,
            size: 'sm',
            id: 'productKeywordTable',
            even: true,//隔行背景
            // toolbar: true,
            where:$.parseJSON(formToJson($("#searchForm").serialize())),
            toolbar: "#toolbarTpl",
            // defaultToolbar: ['filter', 'print', 'exports'], 对应列筛选 打印 导出
            defaultToolbar: ['filter'],
            contentType: 'application/json',
            cols: [[
                {filed: 'uuid', type: 'checkbox', fixed: "left", width: '3%'},
                {field: 'contactPerson', title: '用户名称', sort: true, width: '8%', templet: '#toCUstomerProductKeyword'},
                {field: 'keyword', title: '关键字', width: '10%'},
                {field: 'url', title: '链接', width: '5%'},
                {field: 'originalUrl', title: '原始链接', width: '15%', },
                {field: 'terminalType', title: '终端', width: '7%'},
                {field: 'searchEngine', title: '搜索引擎', width: '6%'},
                // hide: true 设置默认隐藏
                // {field: 'saleRemark', title: '销售备注', width: '6%', hide: true},
                {field: 'bearPawNumber', title: '熊掌号', width: '5%'},
                {field: 'initialPosition', title: '初始排名', width: '5%', },
                {field: 'currentPosition', title: '现排名', width: '10%', },
                {field: 'indexCount', title: '指数', width: '10%', },
                {field: 'positionFirstFee', title: '第一收费', width: '10%', },
                {field: 'positionSecondFee', title: '第二收费', width: '10%', },
                {field: 'positionThirdFee', title: '第三收费', width: '10%', },
                {field: 'positionForthFee', title: '第四收费', width: '10%', },
                {field: 'positionFifthFee', title: '第五收费', width: '10%', },
                {field: 'positionFirstPageFee', title: '首页收费', width: '10%', },
                {field: 'collectMethod', title: '收费方式', width: '10%', },
                {field: 'createTime', title: '创建时间', width: '10%', templet: '#toDateTime'},
                {title: '操作', templet: '#operationTpl', align: 'center', width: '16%'}
            ]],
            height: $(document).height() - $('#productKeywordTable').offset().top - 100,

            done: function (res, curr, count) {
                $("#countNum").text(count);
            }
        });

        $.ajax({
            url: '${ctx.path}/internal/common/getSearchEngines',
            dataType: 'json',
            type: 'post',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            data: JSON.stringify({'terminalType': 'All'}),
            success: function (data) {
                $("#searchEngine").empty();
                $("#searchEngine").append('<option value="">请选择搜索引擎</option>');
                $.each(data.data, function (index, item) {
                    // console.log(item)
                    $('#searchEngine').append('<option value="' + item + '">' + item + '</option>');// 下拉菜单里添加元素
                });
                form.render("select");
            }
        });

        //监听工具条
        var active = {
            reload: function () {
                table.reload('productKeywordTable', {
                    where: $.parseJSON(formToJson($("#searchForm").serialize())),
                    page: {
                        curr: 1 //从第一页开始
                    }
                });
                $("#searchContent").removeClass("layui-show")
            },
        };

        form.on("submit(search)", function (data) {
            table.reload('productKeywordTable', {
                where: data.field,
                page: {
                    curr: 1 //从第一页开始
                }
            });
            $("#searchContent").removeClass("layui-show")
            return false;
        });

        function formToJson(data) {
            data=data.replace(/&/g,"\",\"");
            data=data.replace(/=/g,"\":\"");
            data="{\""+data+"\"}";
            return data;
        }

    });

    function updateOrNewTab(url, tit, id) {
        var update = false;
        var contentIframe = ("<iframe src='" + url + "' lay-id='" + id
            + "'frameborder='0' scrolling='yes' width='100%' height='100%'></iframe>");
        parent.layui.$('.layui-tab-title li').each(function () {
            if (id === this.getAttribute('lay-id')) {
                update = true;
            }
        });
        if (!update) {
            parent.layui.element.tabAdd('ok-tab', {
                    title: tit,
                    content: contentIframe,
                    id: id
                }
            );
        }

        parent.layui.element.tabChange('ok-tab', id)
    }


</script>

<!-- 头工具栏模板 -->
<script type="text/html" id="toolbarTpl">
    <div class="layui-btn-container">
        <@shiro.hasPermission name="/internal/customer/deleteCustomers">
        <button class="layui-btn layui-btn-danger layui-btn-sm" id="batchDel" lay-event="batchDeleteCustomer">
            <i class="layui-icon layui-icon-delete"></i>删除所选
        </button>
        </@shiro.hasPermission>
        <@shiro.hasPermission name="/internal/customer/saveCustomer">
            <button class="layui-btn layui-btn-warn layui-btn-sm" id="batchUpdateDailyReport"
                    lay-event="batchUpdateDailyReport">
            触发所选客户日报表
            </button>
        </@shiro.hasPermission>

        <button class="layui-btn layui-btn-sm" id="addUser" lay-event="addUser">
            <i class="layui-icon">&#xe61f;</i>添加客户
        </button>
    </div>
</script>
<!--模板-->
<script type="text/html" id="toDateTime">
    {{layui.util.toDateString(d.createTime)}}
</script>

<script type="text/html" id="toCUstomerProductKeyword">
    <a href="javascript:updateOrNewTab('/internal/productKeyword/searchProductKeywordsByCustomerUuid/{{d.customerUuid}}','{{d.contactPerson}}-关键字列表', '{{d.customerUuid}}')">{{d.contactPerson}}</a>
</script>

<script type="text/html" id="operationTpl">
    <@shiro.hasPermission name="/internal/customer/saveCustomer">
        <button type="button" class="layui-btn layui-btn-xs" lay-event="edit">修改</button>
    </@shiro.hasPermission>
    <@shiro.hasPermission name="/internal/customer/delCustomer">
        <button type="button" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</button>
    </@shiro.hasPermission>
</script>

</body>
</html>
