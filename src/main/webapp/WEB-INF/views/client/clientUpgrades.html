<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>终端升级</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/lib/layui/css/layui.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/css/scroll-bar.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/css/sub-page.css">
    <link rel="stylesheet" href="${ctx.basePath}/static/ok-admin/lib/nprogress/nprogress.css">
</head>
<body>
<div class="ok-body">
    <!--面包屑导航区域-->
    <div class="ok-body-breadcrumb">
            <span class="layui-breadcrumb">
                <a><cite>机器升级管理</cite></a>
                <a><cite>机器升级列表</cite></a>
            </span>
        <input hidden value='${Session["entryType"]}' id="entryType">
        <a class="layui-btn layui-btn-sm" href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon layui-icon-refresh"></i>
        </a>
    </div>

    <!--数据表格-->
    <table class="layui-hide" id="clientUpgradeTable" lay-filter="tableFilter">
    </table>
</div>

<script src="${ctx.basePath}/static/ok-admin/lib/layui/layui.js"></script>
<script src="${ctx.basePath}/static/ok-admin/lib/nprogress/nprogress.js"></script>

<script>
    var sign = false;
    // 进度条加载提示
    NProgress.start();
    window.onload = function () {
        NProgress.done();
    };
    // layui相关
    layui.use(['element', 'table', 'form', 'jquery', 'laydate', 'okLayer', 'layer'], function () {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        var $ = layui.jquery;
        var laydate = layui.laydate;
        var okLayer = layui.okLayer;
        var layer = layui.layer;
        var clientUpgradeTable = table.render({
            elem: '#clientUpgradeTable',
            method: 'post',
            url: '${ctx.path}/internal/clientUpgrade/getClientUpgrades2',
            limit: 50,
            page: true,
            autoSort: false,
            size: 'sm',
            id: 'clientUpgradeTable',
            even: true,//隔行背景
            toolbar: "#toolbarTpl",
            defaultToolbar: [],
            contentType: 'application/json',
            cols: [[
                {filed: 'uuid', type: 'checkbox', fixed: "left", width: '5%', align: 'center'},
                {field: 'programType', title: '程序类型', width: '10%', align: 'center'},
                {field: 'version', title: '当前版本', width: '10%', align: 'center'},
                {field: 'targetVersion', title: '目标版本', width: '10%', align: 'center'},
                {field: 'maxUpgradeCount', title: '最大升级数', width: '10%', align: 'center'},
                {field: 'residualUpgradeCount', title: '升级情况', width: '15%', templet: '#toResidualUpgradeCount', align: 'center'},
                {field: 'status', title: '任务状态', width: '10%', templet: '#toStatus', align: 'center'},
                {field: 'createTime', title: '创建时间', width: '16%', templet: '#toDateTime', align: 'center', sort: true},
                {title: '操作', templet: '#operationTpl', align: 'center', width: '15%', align: 'center'}
            ]],
            height: 'full-115',

            done: function (res, curr, count) {
                // $("#countNum").text(count);
            }
        });

        //TODO
        //监听排序事件
        // table.on('sort(tableFilter)', function(obj){
        //     console.log(obj)
        //     let data = $.parseJSON(formToJson($("#searchForm").serialize()));
        //     data.orderBy = obj.field;
        //     data.orderMode = obj.type === 'asc' ? 1 : 0;
        //     table.reload('customerTable', {
        //         where: data,
        //         page: {
        //             curr: 1 //从第一页开始
        //         }
        //     });
        // });

    });

</script>

<!-- 头工具栏模板 -->
<script type="text/html" id="toolbarTpl">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" id="addMachine" lay-event="addMachine">
            添加机器
        </button>
    </div>
</script>

<script type="text/html" id="toDateTime">
    {{layui.util.toDateString(d.createTime)}}
</script>

<script type="text/html" id="toResidualUpgradeCount">
    <span>
        {{# if(d.residualUpgradeCount > 0) { }}
            Processing
        {{# }else{ }}
            Completed
        {{# } }}
    </span>
</script>

<script type="text/html" id="toStatus">
    <span>
        {{# if(d.status === true) { }}
            开始
        {{# }else{ }}
            暂停
        {{# } }}
    </span>
</script>

<script type="text/html" id="operationTpl">
    <div class="layui-btn-group">
        {{# if(d.status === true) { }}
            <button type="button" class="layui-btn layui-btn-xs" lay-event="">暂停</button>
        {{# }else { }}
            <button type="button" class="layui-btn layui-btn-xs" lay-event="">开始</button>
        {{# } }}
        <button type="button" class="layui-btn layui-btn-xs" lay-event="">修改</button>
        <button type="button" class="layui-btn layui-btn-xs" lay-event="">删除</button>
    </div>
</script>

</body>
</html>